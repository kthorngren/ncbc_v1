<!DOCTYPE html>
<html>
  <head>
    
    <meta name = "viewport" content = "width = device-width, initial-scale = 1.0">
    <title id="page-title">NC Brewers Cup</title>
    <!-- Datatables Bootstrap Buttons RowGroup Select -->
    <link rel="stylesheet" type="text/css" href="static/css/datatables.min.css"/>
    <!-- DataTables Editor -->
    <link rel="stylesheet" type="text/css" href="static/css/editor.bootstrap.min.css">
    <!-- Bootstrap Toggle -->
    <link rel="stylesheet" type="text/css" href="static/css/bootstrap-toggle.min.css">
    <!-- Select2 -->
    <link rel="stylesheet" type="text/css" href="static/css/select2.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="static/css/font-awesome.min.css">
      <!-- Latest compiled and minified CSS -->
      <link rel="stylesheet" href="static/css/bootstrap-select.min.css">

    <!-- Custom Theme Style -->
    <link rel="stylesheet" type="text/css" href="static/css/custom.min.css">
    
  </head>

  <style>
  

  </style>
  <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <!-- sidebar -->
        <div class="col-md-3 left_col">
          <div class="left_col scroll-view">
            <div class="navbar nav_title" style="border: 0;">
              <a href="index" class="site_title"><i class="fa fa-home"></i> <span id="nav-title"> NC Brewers Cup</span></a>
            </div>
            <div class="clearfix"></div>
            <!-- sidebar menu -->
            <!-- /sidebar menu -->

          </div>
        </div>
        <!-- sidebar -->


        <!-- top navigation -->
        <div class="top_nav">
          <div class="nav_menu">
            <nav class="" role="navigation">
              <div class="nav toggle">
                <a id="menu_toggle"><i class="fa fa-bars"></i></a>
              </div>
            </nav>
          </div>
        </div>                
                


        <!-- page content -->
        <div class="right_col" role="main">
          <div class="">
            <div class="page-title">
              <div class="title_left">
                <h4 id='main-title'>Check In Entries By Brewer</h4>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12 col-sm-12 col-xs-12">

                <div class="x_panel">
                  <div class="x_title">
                    <h2 id="table-title">Entry Check In</h2>
                    <ul class="nav navbar-right panel_toolbox">
                      <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                      </li>
                      <!--
                      <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                        <ul class="dropdown-menu" role="menu">
                          <li><a href="#">Settings 1</a>
                          </li>
                          <li><a href="#">Settings 2</a>
                          </li>
                        </ul>
                      </li>
                      -->
                      <li><a class="close-link"><i class="fa fa-close"></i></a>
                      </li>
                    </ul>
                    <div class="clearfix"></div>
                  </div>
                  <div class="x_content">
                    <p class="text-muted font-13 m-b-30">Place instructions here</p>
                      <div class="text-center">
                      <label for="brewery-choice">Choose Brewery:</label>
                      <input list="breweries" id="brewery-choice" name="brewery-choice"   autocomplete="off"/>
                    </div>
    			  </div>
                          <table id="main-table" class="table table-hover table-bordered table-striped" cellpadding="0" width="100%">
                            <thead>
                              <tr>
                                <th>pkid</th>
                                <th></th>
                                <th>Entry ID</th>
                                <th>Checked In</th>
                                <th>First Round Loc</th>
                                <th>BOS Round Loc</th>
                                <th>One Bottle</th>
                                <th>Comments</th>
                                <th>Category</th>
                                <th>Beer Name</th>
                                <th>Brewer</th>
                              </tr>
	                        </thead>
                          </table>
                </div>
                <!-- /x_panel -->

              </div>
            </div>
            <!-- /row -->
          </div>
        </div>
        <!-- /page content -->



        <!-- footer content -->
        <footer class="right_col_background">
          <div class="pull-right right_col_background">
            NC Brewers Cup
          </div>
          <div class="clearfix right_col_background"></div>
        </footer>
        <!-- /footer content -->

      </div>
    </div>



    <!-- jQuery -->
    <script src="static/js/jquery-3.3.1.min.js"></script>
	<!-- debounce -->
    <script src="static/js/jquery.ba-throttle-debounce.min.js"></script>
    <!-- Datatables Bootstrp Buttons RowGroup Select-->
	<script type="text/javascript" src="static/js/pdfmake.min.js"></script>
	<script type="text/javascript" src="static/js/vfs_fonts.js"></script>
	<script type="text/javascript" src="static/js/datatables.min.js"></script>
    <!-- DataTables Editor -->
    <script type="text/javascript" src="static/js/dataTables.editor.min.js"></script>
    <script type="text/javascript" src="static/js/editor.bootstrap.min.js"></script>
    <!-- Select2 -->
    <script type="text/javascript" src="static/js/editor.select2.js"></script>
    <script type="text/javascript" src="static/js/select2.min.js"></script>
    <!-- Bootstrap Toggle -->
    <script type="text/javascript" src="static/js/bootstrap-toggle.min.js"></script>
      <!-- Latest compiled and minified JavaScript -->
      <script src="static/js/bootstrap-select.min.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="/static/js/custom.min.js"></script>
    <!-- fieldType.toggle -->
    <script src="/static/js/field_type_toggle_plugin.js"></script>


<script>

var editor;



function initMainEditor() {

editor = new $.fn.dataTable.Editor(
{
    table: "#main-table",
	ajax: "dt_checkin_brewer",
	idSrc: 'pkid',
    fields: [
        {
            name: "inventory",
            label: "Checked In:",
	            type: "toggle",
    	        separator: "|",
        	    unselectedValue: [
            	    0
	            ],
    	        options: [
        	        {
            	        label: "",
                	    value: 1
	                }
    	        ]
        },
        {
            name: "location_0",
            label: "First Round Location:"
        },
        {
            name: "location_1",
            label: "BOS Round Location:",
        },
        {
            name: "one_bottle",
            label: "One Bottle:",
	            type: "toggle",
    	        separator: "|",
        	    unselectedValue: [
            	    0
	            ],
    	        options: [
        	        {
            	        label: "",
                	    value: 1
	                }
    	        ]
        },
        {
            name: "comments",
            label: "Comments:"
        },
    ]
});

    // Activate an inline edit on click of a table cell
    $('#main-table').on( 'click', 'tbody td:not(:first-child, :nth-child(2), :nth-child(3), :nth-child(6), :nth-child(8), :nth-child(9), :nth-child(10))', function (e) {
        editor.inline( this, {
            onBlur: 'submit'
        } );
    } );

    $('#main-table').on( 'change', 'input.inventory-enabled', function () {
    	//console.log('change');
        editor
            .edit( $(this).closest('tr'), false )
            .set( 'inventory', $(this).prop( 'checked' ) ? 1 : 0 )
            .submit();
    } );

 
    $('#main-table').on( 'change', 'input.one-enabled', function () {
    	//console.log('change');
        editor
            .edit( $(this).closest('tr'), false )
            .set( 'one_bottle', $(this).prop( 'checked' ) ? 1 : 0 )
            .submit();
    } );



    editor
        .on( 'postCreate postRemove', function () {
            // After create or edit, a number of other rows might have been effected -
            // so we need to reload the table, keeping the paging in the current position
            table.ajax.reload( null, false );
        } )
        .on( 'initCreate', function () {
            // Enable order for create
        } )
        .on( 'initEdit', function () {
            // Disable for edit (re-ordering is performed by click and drag)
        } );

}


function drawMainTable() {
	table = $('#main-table').DataTable({
		ajax: 'dt_checkin_brewer',
    dom: 'Blftirp',
    buttons: ['excel'],
		lengthMenu: [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
		rowId: 'pkid',
		scrollX: true,
	    select: {
    	    style: "multi+shift",
        	selector: "td:first-child"
   		},
   		order: [[2, 'asc']],
		columns: [
	        {
	        	data: 'pkid',
	        	visible: false
	        },
	        {
        	    defaultContent: "",
	            orderable: false
    	    },
	        {
	        	data: 'entry_id',
	        },
	        {
	        	data: 'inventory',
	        	render: function ( data, type, row ) 
	        		{
	        			if ( type === 'display' ) {  
	        				return '<input type="checkbox" class="inventory-enabled">';
	        			}  
	        			return data;
	        		},
            	className: "dt-body-center"
	        },
	        {
	        	data: 'location_0',
	        },
	        {
	        	data: 'location_1',
	        },
	        {
	        	data: 'one_bottle',
	        	render: function ( data, type, row ) 
	        		{
	        			if ( type === 'display' ) {  
	        				return '<input type="checkbox" class="one-enabled">';
	        			}  
	        			return data;
	        		},
            	className: "dt-body-center"
	        },
	        {
	        	data: 'comments',
	        },
	        {
	        	data: 'cat',
	        	render: function ( data, type, row ) 
	        		{
	        			return row.category + row.sub_category + ' - ' + data;
	        		},
	        },
	        {
	        	data: 'name',
	        },
	        {
	        	data: null,
	        	render: function ( data, type, row ) 
	        		{
	        			return row.organization + ': ' + row.firstname + ' ' + row.lastname + '(' + row.email + ')';
	        		},
	        },
	    ],
	    
	    rowCallback: function ( row, data ) 
	    	{ 
	    		$('input.inventory-enabled', row).prop( 'checked', data.inventory == 1 ).bootstrapToggle({size: 'mini', on: 'Yes', off: 'No'});
	    		$('input.one-enabled', row).prop( 'checked', data.one_bottle == 1 ).bootstrapToggle({size: 'mini', on: 'Yes', off: 'No'});
	    	},
	    

	});


}




function buildBrewersSelect() {

  $.ajax({
    url: "/get_brewers",
    type: 'post',
    success: function(json) {
      var data = JSON.parse(json);
            

      var datalist = $('<datalist id="breweries"><option value=""></datalist>')
                        .appendTo('#brewery-choice')

      for (i=0; i<data.length; i++) {
        datalist.append('<option value="' + data[i] + '">')
      }



              
    },
    error: function (jqXHR, exception) {
              
      //set_status('Error collecting version info: ' + get_xhr_error(jqXHR, exception));
    },
                  
  });

}



$(document).ready(function() {
	initMainEditor();
	drawMainTable();
	buildBrewersSelect();
  
  // Search on input change
  $('input[name="brewery-choice"').on('change', function () {
    var val = $(this).val();
    $('#main-table').DataTable().column(10).search(val).draw();
    $(this).blur();  // Remove focus to allow for clearing input next time clicked
  });

  // When focusin (input clicked) or arrow clicked clear the value and reset search
  $('input[name="brewery-choice"').on('click focusin', function () {
    if ($(this).val()) {
      $(this).val('');
      $('#main-table').DataTable().column(10).search("").draw();
    }
  });

});
</script>

</body>
</html>

